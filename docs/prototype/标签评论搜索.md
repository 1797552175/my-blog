# 本期原型 v1（已确认）

基于当前 todo：**标签/分类**、**评论**、**全文搜索**。以下为已按你确认选项定稿的原型，可直接作为 PROJECT_SPEC、API 文档与实现的依据。

---

## 一、标签/分类

### 1.1 目标

- 文章可挂多个标签；读者可按标签浏览文章列表。
- 复用现有 `post_tags` 表（post_id + tag），标签名即分类，不做单独「分类」实体。

### 1.2 已确认选项

- **标签输入方式**：可自由输入新标签，后端按字符串存，GET /api/tags 做聚合供联想即可。
- **列表页**：暂不做热门标签/标签云，仅保留「写文章时选标签 + 列表支持按 tag 筛选」。

### 1.3 后端

| 类型 | 说明 |
|------|------|
| **数据** | 继续用 Post 与 tag 的集合（ElementCollection 或关联表），不建独立 tag 主表，仅 post_tags 存字符串。 |
| **API** | ① **GET /api/tags**：返回全站标签列表（含使用次数），用于写文章时下拉/联想。② 文章创建/更新请求体增加可选字段 `tags: string[]`。③ **GET /api/posts?tag=xxx**：列表接口支持按 tag 过滤（仅已发布）。 |

### 1.4 前端

| 页面/组件 | 说明 |
|-----------|------|
| **写/编文章** | 标签输入：自由输入 + 回车添加，展示为 tag 芯片，可删除。提交时带 `tags` 数组。可选：输入时用 GET /api/tags 做联想补全。 |
| **文章列表 /posts** | 支持 URL 参数 `?tag=xxx`，同页展示筛选后的已发布文章；暂不做侧栏/顶部热门标签。 |

---

## 二、评论

### 2.1 目标

- 文章详情页可看评论、可发评论。
- 支持**游客评论**（昵称 + 邮箱，可选留链接）和**登录用户评论**（自动带用户名，无需再填昵称）。

### 2.2 已确认选项

- **审核**：不审核，先发先显；若后续需要可加 `approved` 字段。
- **内容形式**：纯文本，后端禁止 HTML，前端换行保留即可。反垃圾本期仅做长度与格式校验。

### 2.3 后端

| 类型 | 说明 |
|------|------|
| **数据** | 新增表 **comments**：id, post_id, user_id（可选，空表示游客）, guest_name, guest_email, guest_url（可选）, content, created_at；必要索引 post_id、created_at。 |
| **API** | ① **GET /api/posts/{postId}/comments**：分页，按时间正序。② **POST /api/posts/{postId}/comments**：创建评论。Body：登录时可不传 guest_*；游客时必传 guest_name、guest_email，可选 guest_url；必传 content。校验 content 长度、邮箱格式。 |

### 2.4 前端

| 页面/组件 | 说明 |
|-----------|------|
| **文章详情 /posts/[slug]** | 文末「评论列表」+「发表评论」表单。登录用户：仅「评论内容」输入框；未登录：昵称、邮箱（必填）、网址（选填）、评论内容。提交后刷新评论列表或本地 append。 |
| **展示** | 每条评论：昵称/用户名、时间、内容（纯文本，换行保留）。不展示游客邮箱；回复留后续迭代。 |

---

## 三、全文搜索

### 3.1 目标

- 用户输入关键词，可搜索**已发布**文章的标题或正文，结果列表跳转至现有文章详情。

### 3.2 已确认选项

- **摘要长度**：120 字截断 + “...” 满足。
- **查询与排序**：DB 模糊查询（如 LIKE %q%），默认按**发布时间倒序**；不做标题优先打分（可后续加）。

### 3.3 后端

| 类型 | 说明 |
|------|------|
| **API** | **GET /api/posts/search?q=关键词&page=&size=**：对 title、content_markdown 做 DB 模糊查询，仅 published=true，分页，**按发布时间倒序**。暂不接入 Elastic/Meilisearch。 |

### 3.4 前端

| 页面/组件 | 说明 |
|-----------|------|
| **搜索入口** | 导航栏或首页「搜索」输入框，回车或点击搜索跳转 `/search?q=xxx`。 |
| **搜索结果页 /search** | 读 query `q`，调用 GET /api/posts/search?q=xxx，列表展示：标题、摘要（正文截断 120 字 + “...”）、链接到 /posts/[slug]。无结果时友好提示。 |

### 3.5 创意与增强（可选实现）

在满足上述前提下，可择情实现以提升体验：

| 项 | 说明 |
|----|------|
| **快捷键唤起搜索** | 如 Ctrl+K / Cmd+K 聚焦搜索框或打开搜索浮层，方便常搜用户。 |
| **输入防抖 + Loading** | 若搜索框支持「输入即搜」（如带即时建议），做防抖（如 300ms）并显示 loading，避免每键请求。 |
| **最近搜索** | localStorage 存最近 3～5 条关键词，在搜索页或搜索框下拉中展示，点击即用该词再搜。 |
| **空状态** | 无结果时：插画/文案引导「换几个词试试」或「去 [文章列表](/posts) 逛逛」，减少茫然感。 |
| **摘要尽量含关键词** | 截断 120 字时，若正文中含搜索词，优先从该词附近截取片段，使摘要更贴题（后端或前端均可做）。 |
| **移动端** | 导航栏搜索可收为图标，点击再展开输入框，节省横向空间。 |

---

## 四、本期不做的（避免范围蔓延）

- 标签：不建独立 tag 表、不做标签管理后台、**不做热门标签/标签云**。
- 评论：不做回复层级、不审核、不验证码、**纯文本**不做 Markdown。
- 搜索：不做标题匹配优先打分、不接搜索引擎，仅 DB 模糊查询；摘要 120 字、按时间倒序。

---

## 五、实现顺序

1. **标签**：后端 GET /api/tags、posts 的 tags 读写与 ?tag= 过滤 → 前端写/编文章标签 + 列表 ?tag= 筛选。
2. **评论**：后端 comments 表与两条 API → 前端详情页评论区。
3. **搜索**：后端 search 接口 → 前端搜索框 + /search 结果页（含 120 字摘要、无结果提示）；创意项可穿插或收尾做。

---

本文档为 phase1 定稿原型。后续若做新一期（如用户中心、审核、高亮等），可新建 `prototype-phase2-xxx.md` 等便于区分。
